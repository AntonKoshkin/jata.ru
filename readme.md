# OneMoreBuilder
##### Еще один сборщик.
_________________

## Что может этот сборщик?
1. Компилировать jade
2. Компилировать и минифицировать stylus
3. Собирать, проверять и сжимать js
4. Собирать svg спрайт
5. Поднимать сервер, запускать таски при изменении файлов, перезагружать страницу - как любой нормальный таск-ранер

## Особенности
Для него предусмотрена следующая БЭМ структура:

<pre>
src
	assets						--	директория с файлами, которые просто копируются
										без каких-либо изменений
		fonts						--	директория со шрифтами, кладется в build/
			font_name			--	папка шрифта с названием шрифта в имени
				italic			--	на этом уровне директории по начертаниям
					...
				normal
					300.woof		--	файлы шрифтов, в названии жирность шрифта
					400.woff
					...
			...
		js							--	директория со скриптами, которые не надо собирать
										в общий билд. кладутся в директорию build/jd
			flexbox-polifil.js
			modernizr.js
			...
		...

	blocks						--	директория, в которой хранятся БЭМ-блоки
		block1					--	директория одного БЭМ-блока
			block1.jade			--	разметрка блока (содержит миксин(ы)), инклюдится
										в template.jade
			block1.jpg			--	картинки, используемые в блоке, так же лежат здесь
			block1.js			--	скрипты блока (подключаются в jsCustom.js)
			block1.styl			--	стили блока, импортяться в style.styl
			block1.svg			--	свг блока, в спрайт не собираются
			svg-block1.svg		--	свг с именем svg-* собираются в спрайт
										пнг - скоро
			...

		sprites					--	директория с файлами спрайтов
			svgCash.js			--	скрипт, вносящий свг-спрайт в local storage
			svg-sprite.jade	--	миксин для удобной вставки свг из спрайта

		styleguide
			animations.styl	--	файл с @keyframe'ами
			bicon.styl			--	картинки в base64 и миксин для их вставки
			css-hacks.styl		--	миксины для css хаков
			fonts.styl			--	файл с переменными шрифтов и fant-fase'ами
			geometry.styl		--	миксины с фигурами, рисуемыми чистым css
			mixins.styl			--	файл с миксинами
			placeholders.styl	--	файл с плейсхолдерами
			reset.styl			--	файл со стилями сброса отступов, курсивов и пр.
										стилей по умолчанию, плейсхолдерами, делающими то
										же самое "точечно"
			texts.styl			--	файл с плейсхолдерами текстов и заголовков
			variables.styl		--	файл с переменными
			z-indexes.styl		--	файл с определением z-index'ов. используются
										миксины
			...

		template					--	директория шаблона (не совсем блок, но заслуживает
										своей директории)
			head.jade			--	файл со всем, что прописывается в head (кроме
										тайтла)
										также содержит общии скрипты и jade-миксины,
										не относящиеся к конкретному блоку
			template.jade		--	разметка шаблона (сюда импортяться все блоки,
										экстендит страницы)
			template.styl		--	стили шаблона (html, body, ...)
			...
		...

	layouts						--	директория, содержащая страницы, которые будут
										компилироваться
		contacts.jade			--	страницы, которые будут скомпилированы
		index.jade
		...

	compile						--	диретория для компилируемых файлов скриптов и
										стилей, в которые импортятся все остальные файлы
		jsCustom.js				--	файл собственных сериптов
		jsVendor.js				--	файл сторонних готовых скриптов
		style.styl				--	файл с импортами всех стилевых файлов
		...
</pre>

## Таски

### Сборка картинок
сборщик следит за всеми файлами с разрешениями *.jpg, *.png, *.svg (кроме svg-*.svg, которые используюся для спрайтизации) в директории blocks на любой глубине. он их жмет и кладет в директорию build/img/

### Сборка jade
сборщик обрабатывает только *.jade файлы в директории layouts, но следит (watch) за всеми *.jade файлами. он их компилит и кладет в корень директории build.

#### Нюансы:
Для удобства использования svg спрайта предусмотрен миксин, находится в src/blocks/sprites/svg-sprite.jade (по умолчанию уже подключен в шаблоне).
также стоит помнить, что после компиляции расположение директорий (относительно директорий до компиляции) изменится, так что пути к картинкам надо указывать с добавлением 'img/' в начале. в дальнейшем постараюсь что-нибудь с этим придумать, не хочется в каждом блоке еще дополнительно директории img делать.

### Сборка js
сборщик следит за всеми *.js файлами, но обрабатывает только jsCustom.js и jsVendor.js. их он пропускает через риггер (который инклюдит по указанным в файлах адресам, больше инфо в гугле по gulp-rigger), проверяет код на наличие ошибок (только custom), конкатенирует, именует как main.js, минифицирует если в файле путей переменная isDev равна false, кладет в build/js.

### Сборка stylus
Сборщик следит за всеми *.styl файлами, но обрабатывает только style.styl в  src/compile/ (то есть все надо в него импортить, можно даже *.css файлы). метамарфозы:
- если isDev, то инициализирует карты;
- импортит все и компилит;
дальше идут postCSS плагины
- пишет фонтфейсы для используемых шрифтов (подробнее postcss-font-magician);
- ищет сокращения и заменяет (подробнее postcss-short);
- если используются флексбоксы, то дописывает правила, исправляющие известные баги;
- автопрефиксерирует;
- расчесывает;
- проверяет, не используются ли неподдерживаемые свойства (согласно настройкам);
- если isDev, то записывает карты, если !isDev - минифицирует.
и кладет в build/css/

### Сборка свг спрайта
сборщик следит за всеми svg-*.svg файлами в директории src/blocks на любой глубине, собирает в спрайт, именует svg-sprite.svg и кладет в build/img.
для подключения спрайта рекомендую использовать скрипт src/blocks/sprites/svgCash.js, но никто не заставляет, можно подключать как хочешь :)

### Очиска
таск для очистки удаляет все файлы в директории build не читая.

### build
таск на сборку
последовательно запускает:
- очистку;
- сборку свг спрайта;
- параллельно сборки картинок, jade, js, stylus.

### watch
таск слежения
следит за файлами и при изменении запускает соответствующий таск.

### server
таск сервера
поднимает сервер, открывает в браузере сайт (то, что получается после компиляции), следит за изменениями файлов в директории build, если регистрирует изменения, то перезагружает страницу.

### default
дефолтный таск
запускает таск сборки, после чего запускает параллельно сервер и вотчер.

### config.js
файл с настройками путей и переменной isDev. в дальнейшем перенесу сюда все настройки всех плагинов
